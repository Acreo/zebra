/*
################################################################################
#  THIS FILE IS 100% GENERATED BY ZPROJECT; DO NOT EDIT EXCEPT EXPERIMENTALLY  #
#  Please refer to the README for information about making permanent changes.  #
################################################################################
*/
/*  =========================================================================
      bench.h -  Benchmarking header file, contains common functionality to
                 measure time, run the benchmark and caluculate results.

    Copyright (c) the Contributors as noted in the AUTHORS file.       
    This file is part of CZMQ, the high-level C binding for 0MQ:       
    http://czmq.zeromq.org.                                            
                                                                       
    This Source Code Form is subject to the terms of the Mozilla Public
    License, v. 2.0. If a copy of the MPL was not distributed with this
    file, You can obtain one at http://mozilla.org/MPL/2.0/.           
    =========================================================================
*/

#ifndef BENCH_H
#define BENCH_H

#ifdef __cplusplus
extern "C" {
#endif

#define MICRO_IN_SEC 1000000.00
#define SEC_IN_MIN 60

typedef struct {
    long N; // N for each run
    long R; // runs
    int64_t start;
    int64_t end;
} bench_t;

static void
s_bench_start (bench_t *self)
{
    self->start = zclock_usecs ();
}

static void
s_bench_stop (bench_t *self)
{
    self->end = zclock_usecs ();
}

static double
s_bench_iteration_speed (bench_t *self)
{
    return (self->N * self->R) / ((self->end - self->start) / MICRO_IN_SEC);
}

static double
s_bench_duration (bench_t *self)
{
    return (self->end - self->start) / MICRO_IN_SEC;
}

static void
s_bench_print_summary (bench_t *self)
{
    printf ("%ld runs, ", self->R);
    printf ("%ld iterations each run, ", self->N);
    printf ("finished in %lf seconds\n", s_bench_duration (self));
    printf ("%.2f i/sec\n", s_bench_iteration_speed (self) );
}

#define MEASURE(B) \
        bench_t B; B.N = 1; B.R = 1; \
        printf("Measuring " #B "...\n"); \
        s_bench_start(&B);

#define END_MEASURE(B) \
        s_bench_stop(&B);

#define BENCHMARK(B) \
        printf("Benchmarking " #B "...\n"); \
        bench_t B; B.N = 5000000; B.R = 3; \
        s_bench_start(&B); \
        for (int _r = 0; _r < B.R ; _r++ ) { \
            for (int _i = 0; _i < B.N ; _i++ ) {

#define END_BENCHMARK(B) \
            } \
        } \
        s_bench_stop(&B);

#define BENCHMARK_SUMMARY(B) s_bench_print_summary(&B);

#ifdef __cplusplus
}
#endif

#endif
/*
################################################################################
#  THIS FILE IS 100% GENERATED BY ZPROJECT; DO NOT EDIT EXCEPT EXPERIMENTALLY  #
#  Please refer to the README for information about making permanent changes.  #
################################################################################
*/
